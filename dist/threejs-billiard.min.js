!function(t){"use strict";var i="Hooray",e={};e.isFunction=function(t){return"function"==typeof t},e.isObject=function(t){return"object"==typeof t},e.isUndefined=function(t){return"undefined"==typeof t},e.Namespace=function(n,s){var r,o=n.split("."),a=s?t[s]:e,l=s?s:i;if(e.isUndefined(a)&&(a={},t[s]=a),o[0]===l&&(o=o.slice(1)),o.length>0&&o[0].trim().length>0)for(r=0;r<o.length;r++)e.isUndefined(a[o[r]])&&(a[o[r]]={}),a=a[o[r]];return a};var n=function(t,i){e.isUndefined(t)&&(t={});var n,s,r=e.isFunction(t.init)?t.init:function(){},o=e.isFunction(i);n=function(){var t;return t=this instanceof r?this:Object.create(r.prototype),o&&i.apply(t,arguments),r.apply(t,arguments),t},o&&(r.prototype=Object.create(i.prototype),r.prototype.constructor=r);for(s in t)t.hasOwnProperty(s)&&e.isFunction(t[s])&&"init"!==s&&(r.prototype[s]=t[s]);return n.prototype=r.prototype,n};if(e.define=function(t,i,n,s){var r=e.Namespace(i,t);if(e.isUndefined(r[n]))return r[n]=s,s;throw i.trim().length>0&&(i="."+i),new Error('!!! Cannot define component "'+n+'" of type "'+typeof s+'" in namespace "'+t+i+'" because it would overwrite an existent component !!!')},e.defineClass=function(t,i,s,r,o){return e.define(t,i,s,n(r,o))},e.extendClass=function(t,i,n,s,r){return e.defineClass(t,i,n,r,s)},t[i])throw new Error('!!! The namespace "'+i+'" has already been set and '+i+" cannot handle it appropriately !!!");t[i]=e}(window),function(t,i){"use strict";function e(t){var i={x:0,y:0,event:null},e=document.body.scrollLeft,n=document.documentElement.scrollLeft,s=document.body.scrollTop,r=document.documentElement.scrollTop,o=t.offsetLeft,a=t.offsetTop;return t.addEventListener("mousemove",function(t){var l,h;t.pageX||t.pageY?(l=t.pageX,h=t.pageY):(l=t.clientX+e+n,h=t.clientY+s+r),l-=o,h-=a,i.x=l,i.y=h,i.event=t},!1),i}function n(t,i){t.addEventListener("click",i)}function s(t,i,e,n){var s={};return s.x=t-e/2,s.y=-i+n/2,s}i.define("","Input.Mouse","capture",e),i.define("","Input.Mouse","browserCoordsToThreeCoords",s),i.define("","Input.Mouse","registerClickHandler",n)}(window,Hooray),function(t,i){"use strict";var e=!0,n=function(){e&&console.log.apply(console,arguments)};i.define("","","log",n)}(window,Hooray),function(t,i){"use strict";i.defineClass("","","PubSub",{init:function(){this.topics={}},subscribe:function(t,e){var n=this.topics[t];return i.isUndefined(n)&&(n=[],this.topics[t]=n),n.push(e),this},unsubscribe:function(t,e){var n,s=this.topics[t];if(!i.isUndefined(s))for(n=s.length;n--;)s[n]===e&&s.splice(n,1);return this},publish:function(e){var n,s=this.topics[e],r=this,o=Array.prototype.slice.call(arguments);if(!i.isUndefined(s))for(n=s.length;n--;)!function(){var i=s[n];t.setTimeout(function(){i.apply(r,o.slice(1))},0)}();return this},__getTopics:function(){var t,i={};for(t in this.topics)this.topics.hasOwnProperty(t)&&(i[t]=this.topics[t]);return i}})}(window,Hooray),function(t,i){"use strict";function e(t,i,e,n,s){return{x:s?t*n+i*e:t*n-i*e,y:s?i*n-t*e:i*n+t*e}}i.define("Billiard","Helper.CoordsRotationHelper","rotateCoords",e)}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","","Ball",{init:function(t,e,n,s,r,o){i.log('A new Billiard.Ball instance has been created with id "'+t+'"!'),this.id=t,this.initX=e,this.initY=n,this.radius=s,this.mass=r,this.momentOfInertiaSphere=.4*this.mass*this.radius*this.radius,this.vX=0,this.vY=0,this.pocketDropState=null,this.vAngular=0,this.vAngularZ=0,this.rotationHelper=Billiard.Helper.RotationHelper,this.collisionHelper=Billiard.Helper.CollisionHelper,this.pubSub=o},translateByFraction:function(t){this.mesh.position.x+=t*this.vX,this.mesh.position.y+=t*this.vY},rotateByFraction:function(t){var i=0,e=0,n=this.getVelocity(),s=this.getVelocityAngle();return this.isPerfectlyRotating()||this.pocketDropState?(i=.011,this.rotationHelper.rotateAroundWorldAxisX(this.mesh,-this.vY*t/this.radius),this.rotationHelper.rotateAroundWorldAxisY(this.mesh,this.vX*t/this.radius)):(i=0,e=.055,this.applyTorque(e),this.rotationHelper.rotateAroundWorldAxisX(this.mesh,-this.vAngular*Math.sin(s)),this.rotationHelper.rotateAroundWorldAxisY(this.mesh,this.vAngular*Math.cos(s))),e+n*i},rotateZ:function(){var t=.002;0!==this.vAngularZ&&(this.rotationHelper.rotateAroundWorldAxisZ(this.mesh,this.vAngularZ),this.vAngularZ>0?this.vAngularZ-t<0?this.vAngularZ=0:this.vAngularZ-=t:this.vAngularZ+t>0?this.vAngularZ=0:this.vAngularZ+=t)},applyAbsoluteFriction:function(t,e,n,s){var r=i.isUndefined(e)?this.getVelocity():e,o=i.isUndefined(n)?this.getVelocityAngle():n,a=r,l=this;r>t?(r-=t,Math.abs(r)<s&&(r=0)):r=0,r>0?(this.vX=Math.cos(o)*r,this.vY=Math.sin(o)*r):(this.vX=0,this.vY=0,r!==a&&this.pubSub.publish(Billiard.Event.BALL_STOPPED_ROLLING,{id:l.id,x:l.mesh.position.x,y:l.mesh.position.y}))},applyTorque:function(t){var i=t*this.radius;this.vAngular+=i/this.momentOfInertiaSphere},getVelocityAngle:function(){return Math.atan2(this.vY,this.vX)},getSquaredVelocity:function(){return this.vX*this.vX+this.vY*this.vY},getVelocity:function(t){var e=i.isUndefined(t)?this.getSquaredVelocity():t;return Math.sqrt(e)},isPerfectlyRotating:function(t){var e=i.isUndefined(t)?this.getVelocity():t;return this.vAngular*this.radius>=e},handleCushionCollision:function(t){var i=this.mesh,e=this.radius,n=t.getPlayingFieldWidth()/2,s=t.getPlayingFieldHeight()/2;i.position.x+e>n?(i.position.x=n-e,this.vX*=-1):i.position.x-e<-n&&(i.position.x=-n+e,this.vX*=-1),i.position.y+e>s?(i.position.y=s-e,this.vY*=-1):i.position.y-e<-s&&(i.position.y=-s+e,this.vY*=-1)},isAboutToDropInto:function(t){var i,e,n,s,r,o=!1;return i=this.mesh.position,e=t.mesh.position,n=e.x-i.x,s=e.y-i.y,r=Math.sqrt(n*n+s*s),r<t.radius&&(console.log('Ball "'+this.id+'" is about to drop into pocket "'+t.id+'".'),this.pocketDropState=new Billiard.Pocket.DropState.Phase1(this,t),o=!0),o},dispatchPocketDrop:function(){this.pocketDropState.proceed()},applyBallCollisionReaction:function(t){var i=this.mesh.position,e=t.mesh.position,n=this.collisionHelper.calculateBallCollisionReaction(i.x,i.y,this.vX,this.vY,this.radius,this.mass,e.x,e.y,t.vX,t.vY,t.radius,t.mass,1);this.vAngularZ=n.vAngularZ1,t.vAngularZ=n.vAngularZ2,this.vX=n.vX1,this.vY=n.vY1,t.vX=n.vX2,t.vY=n.vY2},predictCollisionWith:function(t){var i=this.mesh.position,e=t.mesh.position;return this.collisionHelper.getCollisionTime(i.x,i.y,this.vX,this.vY,this.radius,e.x,e.y,t.vX,t.vY,t.radius)}})}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","","Cue",{init:function(t,e){this.id="cue_"+t,this.table=e,i.log('A new Billiard.Cue instance has been created with id "'+this.id+'"!'),this.controlRadius=270,this.otherBalls=[],this.distanceTopLeftToBottomRight=0,this.targetGuide=new Billiard.TargetGuide},augment:function(t,e){this[t]=e;var n=this;if("gameContainer"===t){var s=new THREE.Vector2(-e.width/2,e.height/2),r=new THREE.Vector2(e.width/2,-e.height/2);n.distanceTopLeftToBottomRight=s.distanceTo(r),i.Input.Mouse.registerClickHandler(e.domElement,function(){var t=n.mesh.rotation.z;n.ball0.vX=20*Math.cos(t),n.ball0.vY=20*Math.sin(t)})}},update:function(){if(this.mouse){var t=this.mesh.position,e=this.ball0.mesh.position,n=this.browserCoordsToThreeCoords(this.mouse.x,this.mouse.y,this.gameContainer.width,this.gameContainer.height),s=e.x-n.x,r=e.y-n.y,o=Math.atan2(r,s);t.x=e.x+Math.cos(o+Math.PI)*this.controlRadius,t.y=e.y+Math.sin(o+Math.PI)*this.controlRadius,this.mesh.rotation.z=o,this.targetGuide.update(o,this.ball0,this.otherBalls,this.distanceTopLeftToBottomRight,this.table)}else this.mouse=i.Input.Mouse.capture(this.gameContainer.domElement)},browserCoordsToThreeCoords:i.Input.Mouse.browserCoordsToThreeCoords})}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","","Game",{init:function(t,e,n){i.log("A new Billiard.Game instance has been created!"),this.pubSub=new i.PubSub,this.eventProcessor=new Billiard.Event.EventProcessor(this.pubSub),this.balls=this.initBalls(e,this.pubSub),this.cues=this.initCues(111,222,n),this.gameRenderEngine=new Billiard.GameRenderEngine(t),this.table=n,this.pockets=this.initPockets(n),this.gameLoop=new Billiard.GameLoop(this.gameRenderEngine,this.table,this.balls,this.cues,this.pockets)},prepare:function(){var t=this;return this.gameRenderEngine.initGameRenderEngine(this.table,this.balls,this.cues,this.pockets).then(function(i){t.renderFn=i})},initBalls:function(t,i){var e,n=t.getBalls(),s=t.getBallRadius(),r=t.getBallMass(),o={};for(e in n)n.hasOwnProperty(e)&&(o[e]=new Billiard.Ball(e,n[e].x,n[e].y,s,r,i));return o},initCues:function(t,i,e){var n={};return n[t]=new Billiard.Cue(t,e),n},initPockets:function(t){var i={},e=t.getPockets();for(var n in e)e.hasOwnProperty(n)&&(i[n]=new Billiard.Pocket(n,e[n].x,e[n].y,e[n].radius));return i},start:function(){if(i.isUndefined(this.renderFn))throw new Error("Cannot start uninitialized game! Please call prepare() before start().");this.gameLoop.start(this.renderFn)},stop:function(){this.gameLoop.stop()}})}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","","GameLoop",{init:function(t,e,n,s,r){i.log("A new Billiard.GameLoop instance has been created!"),this.gameRenderEngine=t,this.table=e,this.balls=n,this.cues=s,this.pockets=r,this.ballsArray=[];for(var o in this.balls)this.balls.hasOwnProperty(o)&&this.ballsArray.push(this.balls[o]);this.droppingBalls=[],this.pocketsArray=[];for(var a in this.pockets)this.pockets.hasOwnProperty(a)&&this.pocketsArray.push(this.pockets[a])},mainGameLoop:function(){for(var t,i,e,n,s,r,o,a,l,h=this.ballsArray,u=this.droppingBalls,c=1;c>0;){if(r=this.determineAllBallCollisions(),!(r.length>0)){o=this.translateAllBallsByFraction(c);break}for(r.sort(this.compareCollisionTime),s=r[0].t,o=this.translateAllBallsByFraction(s),r=this.getBallCollisionsAt(s,r),t=0,e=r.length;e>t;t++)r[t].ballA.applyBallCollisionReaction(r[t].ballB);c-=s}for(t=u.length;t--;)u[t].dispatchPocketDrop();for(t=h.length;t--;)for(a=h[t],a.applyAbsoluteFriction(o[t],a.getVelocity(),a.getVelocityAngle(),.05),a.rotateZ(),i=0,n=this.pocketsArray.length;n>i;i++)if(a.isAboutToDropInto(this.pocketsArray[i])){this.droppingBalls.push(a),h.splice(t,1);break}for(l in this.cues)this.cues.hasOwnProperty(l)&&this.cues[l].update()},translateAllBallsByFraction:function(t){var i,e,n,s=[],r=this.ballsArray;for(i=0,e=r.length;e>i;i++)n=r[i],n.translateByFraction(t),s[i]=n.rotateByFraction(t),n.handleCushionCollision(this.table);return s},getBallCollisionsAt:function(t,i){return i.filter(function(i){return i.t===t})},determineAllBallCollisions:function(){var t,i,e,n,s,r,o=[],a=this.ballsArray;for(t=0,e=a.length;e>t;t++)if(s=a[t],e-1>t)for(i=t+1;e>i;i++)r=a[i],n=s.predictCollisionWith(r),null!==n&&n>=0&&1>=n&&o.push({t:n,ballA:s,ballB:r});return o},compareCollisionTime:function(t,i){return t.t-i.t},start:function(i){var e=this;!function n(){e.timerId=t.requestAnimationFrame(n),e.mainGameLoop(),i()}()},stop:function(){i.isUndefined(this.timerId)||t.cancelAnimationFrame(this.timerId)}})}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","","GameRenderEngine",{init:function(t){i.log('A new Billiard.GameRenderEngine instance has been created within "'+t+'"!'),this.gameContainer=this.initGameContainer(t),this.assetLoader=new Billiard.AssetLoader,this.renderer=this.initRenderer(this.gameContainer),this.scene=new THREE.Scene,this.camera=this.initCamera(this.gameContainer,this.scene),this.light=this.initLight(this.scene)},initGameRenderEngine:function(t,e,n,s){var r,o,a,l,h,u,c,d,p,f,g=this,m=Billiard.Helper.RotationHelper,y=[];l=new THREE.PlaneGeometry(t.getPlayingFieldWidth(),t.getPlayingFieldHeight()),h=new THREE.MeshBasicMaterial({color:32768}),c=new THREE.Mesh(l,h),c.position.z=-20,g.scene.add(c);var v=this.assetLoader.getMaps(Object.keys(e)).then(function(t){for(r in e)if(e.hasOwnProperty(r))if(l=new THREE.SphereGeometry(e[r].radius,24,24),h=new THREE.MeshPhongMaterial({map:t[r]}),u=new THREE.Mesh(l,h),u.position.x=e[r].initX,u.position.y=e[r].initY,m.rotateAroundWorldAxisY(u,-Math.PI/2),g.scene.add(u),e[r].mesh=u,"images/ball0.jpg"===r)for(o in n)n.hasOwnProperty(o)&&n[o].augment("ball0",e[r]);else for(o in n)n.hasOwnProperty(o)&&n[o].otherBalls.push(e[r])});y.push(v);for(o in n)n.hasOwnProperty(o)&&(l=new THREE.PlaneGeometry(480,6),h=new THREE.MeshBasicMaterial({color:16776960}),c=new THREE.Mesh(l,h),c.position.z=20,g.scene.add(c),n[o].augment("mesh",c),n[o].augment("gameContainer",g.gameContainer),i.isUndefined(n[o].targetGuide)||(h=new THREE.LineDashedMaterial({color:16777215,linewidth:2,dashSize:8,gapSize:6}),l=new THREE.Geometry,l.vertices.push(new THREE.Vector3(0,0,0)),l.vertices.push(new THREE.Vector3(0,150,0)),l.vertices.push(new THREE.Vector3(150,150,0)),l.computeLineDistances(),p=new THREE.Line(l,h),g.scene.add(p),n[o].targetGuide.augment("mesh",p),h=new THREE.LineBasicMaterial({color:16777215}),l=new THREE.Geometry,l.vertices.push(new THREE.Vector3(0,0,0)),l.vertices.push(new THREE.Vector3(0,150,0)),p=new THREE.Line(l,h),p.position.z=20,g.scene.add(p),n[o].targetGuide.augment("meshAnotherBallReactionLine",p),h=new THREE.LineBasicMaterial({color:16777215}),l=new THREE.CircleGeometry(20,48),l.vertices.shift(),f=new THREE.Line(l,h),f.position.z=20,g.scene.add(f),n[o].targetGuide.augment("meshCircle",f)));for(a in s)s.hasOwnProperty(a)&&(h=new THREE.MeshBasicMaterial({color:16728838}),l=new THREE.CircleGeometry(s[a].radius,32),d=new THREE.Mesh(l,h),d.position.x=s[a].x,d.position.y=s[a].y,g.scene.add(d),s[a].augment("mesh",d));return Q.all(y).then(function(){return function(){g.render()}})},render:function(){this.renderer.render(this.scene,this.camera)},initGameContainer:function(i){var e=t.document.getElementById(i);return{domElement:e,width:e.offsetWidth,height:e.offsetHeight}},initRenderer:function(t){var i=Detector.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer;return i.setSize(t.width,t.height),t.domElement.appendChild(i.domElement),i},initCamera:function(t,e){var n=t.width,s=t.height,r=n/-2,o=n/2,a=s/2,l=s/-2,h=1,u=1e3,c=new THREE.OrthographicCamera(r,o,a,l,h,u);return c.position.z=400,e.add(c),i.log("Initializing camera! [left, right, top, bottom, near, far]",r,o,a,l,h,u),c},initLight:function(t){var i=new THREE.DirectionalLight(16777215,1);return i.position.set(0,0,1),t.add(i),i}})}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","","Pocket",{init:function(t,e,n,s){i.log("A new Billiard.Pocket instance has been created!"),this.id=t,this.x=e,this.y=n,this.radius=s},augment:function(t,i){this[t]=i}}),i.defineClass("Billiard","Pocket.DropState","Phase1",{init:function(t,e){i.log("A new Billiard.Pocket.DropState.Phase1 instance has been created!"),this.ball=t,this.pocket=e,this.aX=0,this.aY=0,this.spring=.05,this.dropFriction=.9,this.scale=.03,this.minScale=.7},proceed:function(){var t=this.ball.mesh.position,i=this.pocket.mesh.position.x-t.x,e=this.pocket.mesh.position.y-t.y,n=Math.sqrt(i*i+e*e);n+this.ball.radius<this.pocket.radius&&this.ball.mesh.scale.x<=this.minScale,this.aX=i*this.spring,this.aY=e*this.spring,this.ball.vX+=this.aX,this.ball.vY+=this.aY,this.ball.vX*=this.dropFriction,this.ball.vY*=this.dropFriction,t.x+=this.ball.vX,t.y+=this.ball.vY,this.ball.rotateByFraction(1),this.ball.rotateZ(),this.ball.mesh.scale.x>this.minScale&&(this.ball.mesh.scale.x-=this.scale,this.ball.mesh.scale.y-=this.scale,this.ball.mesh.scale.z-=this.scale)}})}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","","TargetGuide",{init:function(){i.log("A new Billiard.TargetGuide instance has been created!"),this.collisionHelper=Billiard.Helper.CollisionHelper},augment:function(t,i){this[t]=i},update:function(t,i,e,n,s){var r,o,a,l,h,u,c,d,p,f,g,m,y,v,w,E=Math.sin(t),b=Math.cos(t),B=n*b,H=n*E,A=i.mesh.position,x=1,R=-1;for(r=0,o=e.length;o>r;r++)l=e[r],a=this.collisionHelper.getCollisionTime(A.x,A.y,B,H,i.radius,l.mesh.position.x,l.mesh.position.y,0,0,l.radius),null!==a&&a>=0&&1>=a&&x>a&&(x=a,R=r);if(-1!==R)h=A.x+x*B,u=A.y+x*H,f=e[R],g=f.mesh.position,p=this.collisionHelper.calculateBallCollisionReaction(h,u,80*b,80*E,i.radius,i.mass,g.x,g.y,f.vX,f.vY,f.radius,f.mass,1),c=h+p.vX1,d=u+p.vY1,m=g.x,y=g.y,v=m+.5*p.vX2,w=y+.5*p.vY2;else{var T=this.calculateTgcPositionInFrontOfCushion(t,E,b,i,s);h=T.x,u=T.y,c=h,d=u,m=h,y=u,v=h,w=u}this.mesh.geometry.vertices[0].x=A.x,this.mesh.geometry.vertices[0].y=A.y,this.mesh.geometry.vertices[1].x=h,this.mesh.geometry.vertices[1].y=u,this.mesh.geometry.vertices[2].x=c,this.mesh.geometry.vertices[2].y=d,this.mesh.geometry.verticesNeedUpdate=!0;var C=this.meshAnotherBallReactionLine.geometry.vertices;C[0].x=m,C[0].y=y,C[1].x=v,C[1].y=w,this.meshAnotherBallReactionLine.geometry.verticesNeedUpdate=!0,this.meshCircle.position.x=h,this.meshCircle.position.y=u},calculateTgcPositionInFrontOfCushion:function(t,i,e,n,s){var r,o,a,l,h={},u=n.mesh.position,c=s.getPlayingFieldWidth()/2,d=s.getPlayingFieldHeight()/2,p=Math.PI/2;return t>=0&&p>=t?(o=c-n.radius-u.x,a=o/e,r=a*i,l=r+u.y,l<d-n.radius?(h.x=c-n.radius,h.y=l):(r=d-n.radius-u.y,a=r/i,o=a*e,h.x=o+u.x,h.y=d-n.radius)):t>p&&t<=Math.PI?(o=u.x+c-n.radius,a=o/e,r=a*i,l=-r+u.y,l<d-n.radius?(h.x=-c+n.radius,h.y=l):(r=d-n.radius-u.y,a=r/i,o=a*e,h.x=o+u.x,h.y=d-n.radius)):0>t&&t>=-p?(o=c-n.radius-u.x,a=o/e,r=a*i,l=r+u.y,l>-d+n.radius?(h.x=c-n.radius,h.y=l):(r=u.y+d-n.radius,a=r/i,o=a*e,h.x=-o+u.x,h.y=-d+n.radius)):(o=u.x+c-n.radius,a=o/e,r=a*i,l=-r+u.y,l>-d+n.radius?(h.x=-c+n.radius,h.y=l):(r=u.y+d-n.radius,a=r/i,o=a*e,h.x=-o+u.x,h.y=-d+n.radius)),h}})}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","","AssetLoader",{init:function(){i.log("A new Billiard.AssetLoader instance has been created!"),this.maps={},this.textureLoader=new THREE.TextureLoader},getMap:function(t){if(i.isUndefined(this.maps[t])){var e,n,s,r=Q.defer(),o=this;return e=function(e){i.log('[Billiard.AssetLoader] Texture "'+t+'" loaded.'),o.maps[t]=e,r.resolve(e)},n=function(e){i.log('[Billiard.AssetLoader] Loading texture "'+t+'"...',e),r.notify(e)},s=function(e){i.log('[Billiard.AssetLoader] Error while loading texture "'+t+'".'),r.reject(e)},this.textureLoader.load(t,e,n,s),r.promise}return i.log('[Billiard.AssetLoader] Returning cached texture "'+t+'".'),Q.when(this.maps[t])},getMaps:function(t){var i,e,n=[];for(i=0,e=t.length;e>i;i++)n.push(this.getMap(t[i]));return Q.all(n).then(function(n){var s={};for(i=0,e=t.length;e>i;i++)s[t[i]]=n[i];return s})}})}(window,Hooray),function(t,i){"use strict";function e(t,i,e,n,s,r,a,l,h,u){var c,d,p,f,g,m,y,v,w,E=o.tmp1,b=o.tmp2,B=o.p0;B.set(t,i);var H=o.pf;H.set(t+e,i+n);var A=H.sub(B),x=o.q0;x.set(r,a);var R=o.qf;R.set(r+l,a+h);var T=R.sub(x);E.subVectors(T,A),m=E.length(),c=m*m,b.subVectors(x,B),b.multiplyScalar(2),d=b.dot(E),b.subVectors(x,B),y=b.length(),v=s+u,p=y*y-v*v;var C=d*d,L=4*c*p,P=C-L;return P>=0?(w=Math.sqrt(P),f=(-d+w)/(2*c),g=(-d-w)/(2*c),Math.min(f,g)):null}function n(t,i,e,n,o,a,l,h,u,c,d,p,f){var g,m,y={},v=l-t,w=h-i,E=Math.atan2(w,v),b=Math.sin(E),B=Math.cos(E),H=f,A=r.rotateCoords(e,n,b,B,!0),x=r.rotateCoords(u,c,b,B,!0),R=1/(a+p),T=(a-H*p)*A.x*R+(1+H)*p*x.x*R,C=(1+H)*a*A.x*R+(p-H*a)*x.x*R;if(0===A.x&&0===A.y?(g=x.x,m=x.y):(g=A.x,m=A.y),s(g,m,v,w)){var L=5/7;y.vAngularZ1=-L*(A.y/o),y.vAngularZ2=L*(x.y/d),A.y=L*A.y,x.y=L*x.y}else y.vAngularZ1=0,y.vAngularZ2=0;var P=r.rotateCoords(T,A.y,b,B,!1),M=r.rotateCoords(C,x.y,b,B,!1);return y.vX1=P.x,y.vY1=P.y,y.vX2=M.x,y.vY2=M.y,y}function s(t,i,e,n){var s=t*e+i*n,r=Math.sqrt(t*t+i*i),o=Math.sqrt(e*e+n*n),a=s/(r*o),l=Math.acos(a);return l%(Math.PI/2)!==0}var r=Billiard.Helper.CoordsRotationHelper,o={p0:new THREE.Vector2(0,0),pf:new THREE.Vector2(0,0),q0:new THREE.Vector2(0,0),qf:new THREE.Vector2(0,0),tmp1:new THREE.Vector2(0,0),tmp2:new THREE.Vector2(0,0)};i.define("Billiard","Helper.CollisionHelper","getCollisionTime",e),i.define("Billiard","Helper.CollisionHelper","calculateBallCollisionReaction",n)}(window,Hooray),function(t,i){"use strict";function e(t,i,e){o.setFromAxisAngle(i,e),t.quaternion.multiplyQuaternions(o,t.quaternion)}function n(t,i){e(t,a,i)}function s(t,i){e(t,l,i)}function r(t,i){e(t,h,i)}var o=new THREE.Quaternion,a=new THREE.Vector3(0,0,1).normalize(),l=new THREE.Vector3(0,1,0).normalize(),h=new THREE.Vector3(1,0,0).normalize();i.define("Billiard","Helper.RotationHelper","rotateAroundWorldAxisZ",n),i.define("Billiard","Helper.RotationHelper","rotateAroundWorldAxisY",s),i.define("Billiard","Helper.RotationHelper","rotateAroundWorldAxisX",r)}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","Event","EventProcessor",{init:function(t){i.log("A new Billiard.Event.EventProcessor instance has been created!"),this.pubSub=t,this.registerHandlers(this.pubSub)},registerHandlers:function(t){t.subscribe(Billiard.Event.BALL_STOPPED_ROLLING,function(t){i.log("[EventProcessor]",Billiard.Event.BALL_STOPPED_ROLLING,t)})}})}(window,Hooray),function(t,i){"use strict";i.define("Billiard","Event","BALL_STOPPED_ROLLING","BALL_STOPPED_ROLLING"),i.define("Billiard","Event","BALL_STARTED_ROLLING","BALL_STARTED_ROLLING")}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","Table","Default",{init:function(t,e){i.log("A new Billiard.Table.Default instance has been created!"),this.playingFieldWidth=t,this.playingFieldHeight=e,this.backgroundTexture="images/table_default.png";var n=24;this.pockets={top:{x:0,y:e/2-n,radius:n},topLeft:{x:-(t/2)+n,y:e/2-n,radius:n},topRight:{x:t/2-n,y:e/2-n,radius:n},bottom:{x:0,y:-(e/2)+n,radius:n},bottomLeft:{x:-(t/2)+n,y:-(e/2)+n,radius:n},bottomRight:{x:t/2-n,y:-(e/2)+n,radius:n}}},getPlayingFieldWidth:function(){return this.playingFieldWidth},getPlayingFieldHeight:function(){return this.playingFieldHeight},getBackgroundTexture:function(){return this.backgroundTexture},getPockets:function(){return this.pockets}})}(window,Hooray),function(t,i){"use strict";i.defineClass("Billiard","Rules","EightBall",{init:function(){i.log("A new Billiard.Rules.EightBall instance has been created!"),this.radius=20,this.ballIdTpl="images/ball#.jpg";var t=this._getRack();this.balls=this._getRackPositions(t),this.mass=1},_id:function(t){if(i.isUndefined(this.ballIdTpl))throw new Error("this.ballIdTpl is not defined!");return this.ballIdTpl.replace("#",t)},_getRack:function(){var t=this;return[[t._id(1),t._id(9),t._id(11),t._id(3),t._id(14)],[t._id(10),t._id(8),t._id(13),t._id(6)],[t._id(2),t._id(7),t._id(5)],[t._id(15),t._id(12)],[t._id(4)]]},_getRackPositions:function(t){for(var i,e,n,s={},r=-30*(Math.PI/180),o=150,a=0,l=0,h=0,u=0;u<t.length;u++){l=u*Math.cos(-1*r)*(this.radius+1)*2,h=u*Math.sin(-1*r)*(this.radius+1)*2;for(var c=0;c<t[u].length;c++)i=t[u][c],u||c||(s[this._id(0)]={x:-300,y:0}),e=o+l+Math.cos(r)*(this.radius+1)*2*c,n=a+h+Math.sin(r)*(this.radius+1)*2*c,s[i]={x:e,y:n}}return s},getBalls:function(){var t,i={};for(t in this.balls)this.balls.hasOwnProperty(t)&&(i[t]=this.balls[t]);return i},getBallRadius:function(){return this.radius},getBallMass:function(){return this.mass}})}(window,Hooray);