!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.ThreeJsBilliard=t()}}(function(){return function t(i,e,s){function n(r,a){if(!e[r]){if(!i[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+r+"'")}var h=e[r]={exports:{}};i[r][0].call(h.exports,function(t){var e=i[r][1][t];return n(e?e:t)},h,h.exports,t,i,e,s)}return e[r].exports}for(var o="function"==typeof require&&require,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(t,i){i.exports=function(){"use strict";function t(t){return"function"==typeof t}function i(t){return"object"==typeof t}function e(t){return"undefined"==typeof t}function s(i,s){e(i)&&(i={});var n,o,r=t(i.init)?i.init:function(){},a=t(s);n=function(){var t;return t=this instanceof r?this:Object.create(r.prototype),a&&s.apply(t,arguments),r.apply(t,arguments),t},a&&(r.prototype=Object.create(s.prototype),r.prototype.constructor=r);for(o in i)i.hasOwnProperty(o)&&t(i[o])&&"init"!==o&&(r.prototype[o]=i[o]);return n.prototype=r.prototype,n}function n(t,i){return s(i,t)}return{isFunction:t,isObject:i,isUndefined:e,Class:s,extendClass:n}}()},{}],2:[function(t,i){i.exports=function(){"use strict";function t(t){var i={x:0,y:0,event:null},e=document.body.scrollLeft,s=document.documentElement.scrollLeft,n=document.body.scrollTop,o=document.documentElement.scrollTop,r=t.offsetLeft,a=t.offsetTop;return t.addEventListener("mousemove",function(t){var l,h;t.pageX||t.pageY?(l=t.pageX,h=t.pageY):(l=t.clientX+e+s,h=t.clientY+n+o),l-=r,h-=a,i.x=l,i.y=h,i.event=t},!1),i}function i(t,i){t.addEventListener("click",i)}function e(t,i,e,s){var n={};return n.x=t-e/2,n.y=-i+s/2,n}return{capture:t,registerClickHandler:i,browserCoordsToThreeCoords:e}}()},{}],3:[function(t,i){i.exports=function(){"use strict";var t=!0,i=function(){t&&console.log.apply(console,arguments)};return{log:i}}()},{}],4:[function(t,i){i.exports=function(t){"use strict";return t.Class({init:function(){this.topics={}},subscribe:function(i,e){var s=this.topics[i];return t.isUndefined(s)&&(s=[],this.topics[i]=s),s.push(e),this},unsubscribe:function(i,e){var s,n=this.topics[i];if(!t.isUndefined(n))for(s=n.length;s--;)n[s]===e&&n.splice(s,1);return this},publish:function(i){var e,s=this.topics[i],n=this,o=Array.prototype.slice.call(arguments);if(!t.isUndefined(s))for(e=s.length;e--;)!function(){var t=s[e];setTimeout(function(){t.apply(n,o.slice(1))},0)}();return this},__getTopics:function(){var t,i={};for(t in this.topics)this.topics.hasOwnProperty(t)&&(i[t]=this.topics[t]);return i}})}(t("./foundation"))},{"./foundation":1}],5:[function(t,i){i.exports=function(t,i,e,s,n,o){"use strict";return t.Class({init:function(t,e,s,n,o,r){i.log('A new Billiard.Ball instance has been created with id "'+t+'"!'),this.id=t,this.initX=e,this.initY=s,this.radius=n,this.mass=o,this.momentOfInertiaSphere=.4*this.mass*this.radius*this.radius,this.vX=0,this.vY=0,this.pocketDropState=null,this.vAngular=0,this.vAngularZ=0,this.pubSub=r},translateByFraction:function(t){this.mesh.position.x+=t*this.vX,this.mesh.position.y+=t*this.vY},rotateByFraction:function(t){var i=0,e=0,s=this.getVelocity(),o=this.getVelocityAngle();return this.isPerfectlyRotating()||this.pocketDropState?(i=.011,n.rotateAroundWorldAxisX(this.mesh,-this.vY*t/this.radius),n.rotateAroundWorldAxisY(this.mesh,this.vX*t/this.radius)):(i=0,e=.055,this.applyTorque(e),n.rotateAroundWorldAxisX(this.mesh,-this.vAngular*Math.sin(o)),n.rotateAroundWorldAxisY(this.mesh,this.vAngular*Math.cos(o))),e+s*i},rotateZ:function(){var t=.002;0!==this.vAngularZ&&(n.rotateAroundWorldAxisZ(this.mesh,this.vAngularZ),this.vAngularZ>0?this.vAngularZ-t<0?this.vAngularZ=0:this.vAngularZ-=t:this.vAngularZ+t>0?this.vAngularZ=0:this.vAngularZ+=t)},applyAbsoluteFriction:function(i,s,n,o){var r=t.isUndefined(s)?this.getVelocity():s,a=t.isUndefined(n)?this.getVelocityAngle():n,l=r,h=this;r>i?(r-=i,Math.abs(r)<o&&(r=0)):r=0,r>0?(this.vX=Math.cos(a)*r,this.vY=Math.sin(a)*r):(this.vX=0,this.vY=0,r!==l&&this.pubSub.publish(e.BALL_STOPPED_ROLLING,{id:h.id,x:h.mesh.position.x,y:h.mesh.position.y}))},applyTorque:function(t){var i=t*this.radius;this.vAngular+=i/this.momentOfInertiaSphere},getVelocityAngle:function(){return Math.atan2(this.vY,this.vX)},getSquaredVelocity:function(){return this.vX*this.vX+this.vY*this.vY},getVelocity:function(i){var e=t.isUndefined(i)?this.getSquaredVelocity():i;return Math.sqrt(e)},isPerfectlyRotating:function(i){var e=t.isUndefined(i)?this.getVelocity():i;return this.vAngular*this.radius>=e},handleCushionCollision:function(t){var i=this.mesh,e=this.radius,s=t.getPlayingFieldWidth()/2,n=t.getPlayingFieldHeight()/2;i.position.x+e>s?(i.position.x=s-e,this.vX*=-1):i.position.x-e<-s&&(i.position.x=-s+e,this.vX*=-1),i.position.y+e>n?(i.position.y=n-e,this.vY*=-1):i.position.y-e<-n&&(i.position.y=-n+e,this.vY*=-1)},isAboutToDropInto:function(t){var i,e,n,o,r,a=!1;return i=this.mesh.position,e=t.mesh.position,n=e.x-i.x,o=e.y-i.y,r=Math.sqrt(n*n+o*o),r<t.radius&&(console.log('Ball "'+this.id+'" is about to drop into pocket "'+t.id+'".'),this.pocketDropState=new s(this,t),a=!0),a},dispatchPocketDrop:function(){this.pocketDropState.proceed()},applyBallCollisionReaction:function(t){var i=this.mesh.position,e=t.mesh.position,s=o.calculateBallCollisionReaction(i.x,i.y,this.vX,this.vY,this.radius,this.mass,e.x,e.y,t.vX,t.vY,t.radius,t.mass,1);this.vAngularZ=s.vAngularZ1,t.vAngularZ=s.vAngularZ2,this.vX=s.vX1,this.vY=s.vY1,t.vX=s.vX2,t.vY=s.vY2},predictCollisionWith:function(t){var i=this.mesh.position,e=t.mesh.position;return o.getCollisionTime(i.x,i.y,this.vX,this.vY,this.radius,e.x,e.y,t.vX,t.vY,t.radius)}})}(t("../basics/foundation"),t("../basics/log"),t("./events/events"),t("./drop_states/phase1"),t("./helpers/rotation_helper"),t("./helpers/collision_helper"))},{"../basics/foundation":1,"../basics/log":3,"./drop_states/phase1":12,"./events/events":14,"./helpers/collision_helper":15,"./helpers/rotation_helper":17}],6:[function(t,i){i.exports=function(t,i,e,s,n){"use strict";return t.Class({init:function(t,e){this.id="cue_"+t,this.table=e,i.log('A new Billiard.Cue instance has been created with id "'+this.id+'"!'),this.controlRadius=270,this.otherBalls=[],this.distanceTopLeftToBottomRight=0,this.targetGuide=new n},augment:function(t,i){this[t]=i;var n=this;if("gameContainer"===t){var o=new e.Vector2(-i.width/2,i.height/2),r=new e.Vector2(i.width/2,-i.height/2);n.distanceTopLeftToBottomRight=o.distanceTo(r),s.registerClickHandler(i.domElement,function(){var t=n.mesh.rotation.z;n.ball0.vX=20*Math.cos(t),n.ball0.vY=20*Math.sin(t)})}},update:function(){if(this.mouse){var t=this.mesh.position,i=this.ball0.mesh.position,e=this.browserCoordsToThreeCoords(this.mouse.x,this.mouse.y,this.gameContainer.width,this.gameContainer.height),n=i.x-e.x,o=i.y-e.y,r=Math.atan2(o,n);t.x=i.x+Math.cos(r+Math.PI)*this.controlRadius,t.y=i.y+Math.sin(r+Math.PI)*this.controlRadius,this.mesh.rotation.z=r,this.targetGuide.update(r,this.ball0,this.otherBalls,this.distanceTopLeftToBottomRight,this.table)}else this.mouse=s.capture(this.gameContainer.domElement)},browserCoordsToThreeCoords:s.browserCoordsToThreeCoords})}(t("../basics/foundation"),t("../basics/log"),window.THREE,t("../basics/input"),t("./billiard_target_guide"))},{"../basics/foundation":1,"../basics/input":2,"../basics/log":3,"./billiard_target_guide":11}],7:[function(t,i){i.exports=function(t,i,e,s,n,o,r,a,l){"use strict";return t.Class({init:function(t,r,a){i.log("A new Billiard.Game instance has been created!"),this.pubSub=new e,this.eventProcessor=new s(this.pubSub),this.balls=this.initBalls(r,this.pubSub),this.cues=this.initCues(111,222,a),this.gameRenderEngine=new n(t),this.table=a,this.pockets=this.initPockets(a),this.gameLoop=new o(this.gameRenderEngine,this.table,this.balls,this.cues,this.pockets)},prepare:function(){var t=this;return this.gameRenderEngine.initGameRenderEngine(this.table,this.balls,this.cues,this.pockets).then(function(i){t.renderFn=i})},initBalls:function(t,i){var e,s=t.getBalls(),n=t.getBallRadius(),o=t.getBallMass(),a={};for(e in s)s.hasOwnProperty(e)&&(a[e]=new r(e,s[e].x,s[e].y,n,o,i));return a},initCues:function(t,i,e){var s={};return s[t]=new a(t,e),s},initPockets:function(t){var i={},e=t.getPockets();for(var s in e)e.hasOwnProperty(s)&&(i[s]=new l(s,e[s].x,e[s].y,e[s].radius));return i},start:function(){if(t.isUndefined(this.renderFn))throw new Error("Cannot start uninitialized game! Please call prepare() before start().");this.gameLoop.start(this.renderFn)},stop:function(){this.gameLoop.stop()}})}(t("../basics/foundation"),t("../basics/log"),t("../basics/pub_sub"),t("./events/event_processor"),t("./billiard_game_render_engine"),t("./billiard_game_loop"),t("./billiard_ball"),t("./billiard_cue"),t("./billiard_pocket"))},{"../basics/foundation":1,"../basics/log":3,"../basics/pub_sub":4,"./billiard_ball":5,"./billiard_cue":6,"./billiard_game_loop":8,"./billiard_game_render_engine":9,"./billiard_pocket":10,"./events/event_processor":13}],8:[function(t,i){i.exports=function(t,i){"use strict";return t.Class({init:function(t,e,s,n,o){i.log("A new Billiard.GameLoop instance has been created!"),this.gameRenderEngine=t,this.table=e,this.balls=s,this.cues=n,this.pockets=o,this.ballsArray=[];for(var r in this.balls)this.balls.hasOwnProperty(r)&&this.ballsArray.push(this.balls[r]);this.droppingBalls=[],this.pocketsArray=[];for(var a in this.pockets)this.pockets.hasOwnProperty(a)&&this.pocketsArray.push(this.pockets[a])},mainGameLoop:function(){for(var t,i,e,s,n,o,r,a,l,h=this.ballsArray,u=this.droppingBalls,c=1;c>0;){if(o=this.determineAllBallCollisions(),!(o.length>0)){r=this.translateAllBallsByFraction(c);break}for(o.sort(this.compareCollisionTime),n=o[0].t,r=this.translateAllBallsByFraction(n),o=this.getBallCollisionsAt(n,o),t=0,e=o.length;e>t;t++)o[t].ballA.applyBallCollisionReaction(o[t].ballB);c-=n}for(t=u.length;t--;)u[t].dispatchPocketDrop();for(t=h.length;t--;)for(a=h[t],a.applyAbsoluteFriction(r[t],a.getVelocity(),a.getVelocityAngle(),.05),a.rotateZ(),i=0,s=this.pocketsArray.length;s>i;i++)if(a.isAboutToDropInto(this.pocketsArray[i])){this.droppingBalls.push(a),h.splice(t,1);break}for(l in this.cues)this.cues.hasOwnProperty(l)&&this.cues[l].update()},translateAllBallsByFraction:function(t){var i,e,s,n=[],o=this.ballsArray;for(i=0,e=o.length;e>i;i++)s=o[i],s.translateByFraction(t),n[i]=s.rotateByFraction(t),s.handleCushionCollision(this.table);return n},getBallCollisionsAt:function(t,i){return i.filter(function(i){return i.t===t})},determineAllBallCollisions:function(){var t,i,e,s,n,o,r=[],a=this.ballsArray;for(t=0,e=a.length;e>t;t++)if(n=a[t],e-1>t)for(i=t+1;e>i;i++)o=a[i],s=n.predictCollisionWith(o),null!==s&&s>=0&&1>=s&&r.push({t:s,ballA:n,ballB:o});return r},compareCollisionTime:function(t,i){return t.t-i.t},start:function(t){var i=this;!function e(){i.timerId=requestAnimationFrame(e),i.mainGameLoop(),t()}()},stop:function(){t.isUndefined(this.timerId)||cancelAnimationFrame(this.timerId)}})}(t("../basics/foundation"),t("../basics/log"))},{"../basics/foundation":1,"../basics/log":3}],9:[function(t,i){i.exports=function(t,i,e,s,n,o,r){"use strict";return t.Class({init:function(t){i.log('A new Billiard.GameRenderEngine instance has been created within "'+t+'"!'),this.gameContainer=this.initGameContainer(t),this.assetLoader=new o,this.renderer=this.initRenderer(this.gameContainer),this.scene=new e.Scene,this.camera=this.initCamera(this.gameContainer,this.scene),this.light=this.initLight(this.scene)},initGameRenderEngine:function(i,n,o,a){var l,h,u,c,d,p,f,g,m,b,y=this,v=[];c=new e.PlaneGeometry(i.getPlayingFieldWidth(),i.getPlayingFieldHeight()),d=new e.MeshBasicMaterial({color:32768}),f=new e.Mesh(c,d),f.position.z=-20,y.scene.add(f);var x=this.assetLoader.getMaps(Object.keys(n)).then(function(t){for(l in n)if(n.hasOwnProperty(l))if(c=new e.SphereGeometry(n[l].radius,24,24),d=new e.MeshPhongMaterial({map:t[l]}),p=new e.Mesh(c,d),p.position.x=n[l].initX,p.position.y=n[l].initY,r.rotateAroundWorldAxisY(p,-Math.PI/2),y.scene.add(p),n[l].mesh=p,"images/ball0.jpg"===l)for(h in o)o.hasOwnProperty(h)&&o[h].augment("ball0",n[l]);else for(h in o)o.hasOwnProperty(h)&&o[h].otherBalls.push(n[l])});v.push(x);for(h in o)o.hasOwnProperty(h)&&(c=new e.PlaneGeometry(480,6),d=new e.MeshBasicMaterial({color:16776960}),f=new e.Mesh(c,d),f.position.z=20,y.scene.add(f),o[h].augment("mesh",f),o[h].augment("gameContainer",y.gameContainer),t.isUndefined(o[h].targetGuide)||(d=new e.LineDashedMaterial({color:16777215,linewidth:2,dashSize:8,gapSize:6}),c=new e.Geometry,c.vertices.push(new e.Vector3(0,0,0)),c.vertices.push(new e.Vector3(0,150,0)),c.vertices.push(new e.Vector3(150,150,0)),c.computeLineDistances(),m=new e.Line(c,d),y.scene.add(m),o[h].targetGuide.augment("mesh",m),d=new e.LineBasicMaterial({color:16777215}),c=new e.Geometry,c.vertices.push(new e.Vector3(0,0,0)),c.vertices.push(new e.Vector3(0,150,0)),m=new e.Line(c,d),m.position.z=20,y.scene.add(m),o[h].targetGuide.augment("meshAnotherBallReactionLine",m),d=new e.LineBasicMaterial({color:16777215}),c=new e.CircleGeometry(20,48),c.vertices.shift(),b=new e.Line(c,d),b.position.z=20,y.scene.add(b),o[h].targetGuide.augment("meshCircle",b)));for(u in a)a.hasOwnProperty(u)&&(d=new e.MeshBasicMaterial({color:16728838}),c=new e.CircleGeometry(a[u].radius,32),g=new e.Mesh(c,d),g.position.x=a[u].x,g.position.y=a[u].y,y.scene.add(g),a[u].augment("mesh",g));return s.all(v).then(function(){return function(){y.render()}})},render:function(){this.renderer.render(this.scene,this.camera)},initGameContainer:function(t){var i=document.getElementById(t);return{domElement:i,width:i.offsetWidth,height:i.offsetHeight}},initRenderer:function(t){var i=n.webgl?new e.WebGLRenderer:new e.CanvasRenderer;return i.setSize(t.width,t.height),t.domElement.appendChild(i.domElement),i},initCamera:function(t,s){var n=t.width,o=t.height,r=n/-2,a=n/2,l=o/2,h=o/-2,u=1,c=1e3,d=new e.OrthographicCamera(r,a,l,h,u,c);return d.position.z=400,s.add(d),i.log("Initializing camera! [left, right, top, bottom, near, far]",r,a,l,h,u,c),d},initLight:function(t){var i=new e.DirectionalLight(16777215,1);return i.position.set(0,0,1),t.add(i),i}})}(t("../basics/foundation"),t("../basics/log"),window.THREE,window.Q,window.Detector,t("../infrastructure/asset_loader"),t("./helpers/rotation_helper"))},{"../basics/foundation":1,"../basics/log":3,"../infrastructure/asset_loader":20,"./helpers/rotation_helper":17}],10:[function(t,i){i.exports=function(t,i){"use strict";return t.Class({init:function(t,e,s,n){i.log("A new Billiard.Pocket instance has been created!"),this.id=t,this.x=e,this.y=s,this.radius=n},augment:function(t,i){this[t]=i}})}(t("../basics/foundation"),t("../basics/log"))},{"../basics/foundation":1,"../basics/log":3}],11:[function(t,i){i.exports=function(t,i,e){"use strict";return t.Class({init:function(){i.log("A new Billiard.TargetGuide instance has been created!")},augment:function(t,i){this[t]=i},update:function(t,i,s,n,o){var r,a,l,h,u,c,d,p,f,g,m,b,y,v,x,w=Math.sin(t),A=Math.cos(t),_=n*A,C=n*w,B=i.mesh.position,L=1,P=-1;for(r=0,a=s.length;a>r;r++)h=s[r],l=e.getCollisionTime(B.x,B.y,_,C,i.radius,h.mesh.position.x,h.mesh.position.y,0,0,h.radius),null!==l&&l>=0&&1>=l&&L>l&&(L=l,P=r);if(-1!==P)u=B.x+L*_,c=B.y+L*C,g=s[P],m=g.mesh.position,f=e.calculateBallCollisionReaction(u,c,80*A,80*w,i.radius,i.mass,m.x,m.y,g.vX,g.vY,g.radius,g.mass,1),d=u+f.vX1,p=c+f.vY1,b=m.x,y=m.y,v=b+.5*f.vX2,x=y+.5*f.vY2;else{var T=this.calculateTgcPositionInFrontOfCushion(t,w,A,i,o);u=T.x,c=T.y,d=u,p=c,b=u,y=c,v=u,x=c}this.mesh.geometry.vertices[0].x=B.x,this.mesh.geometry.vertices[0].y=B.y,this.mesh.geometry.vertices[1].x=u,this.mesh.geometry.vertices[1].y=c,this.mesh.geometry.vertices[2].x=d,this.mesh.geometry.vertices[2].y=p,this.mesh.geometry.verticesNeedUpdate=!0;var M=this.meshAnotherBallReactionLine.geometry.vertices;M[0].x=b,M[0].y=y,M[1].x=v,M[1].y=x,this.meshAnotherBallReactionLine.geometry.verticesNeedUpdate=!0,this.meshCircle.position.x=u,this.meshCircle.position.y=c},calculateTgcPositionInFrontOfCushion:function(t,i,e,s,n){var o,r,a,l,h={},u=s.mesh.position,c=n.getPlayingFieldWidth()/2,d=n.getPlayingFieldHeight()/2,p=Math.PI/2;return t>=0&&p>=t?(r=c-s.radius-u.x,a=r/e,o=a*i,l=o+u.y,l<d-s.radius?(h.x=c-s.radius,h.y=l):(o=d-s.radius-u.y,a=o/i,r=a*e,h.x=r+u.x,h.y=d-s.radius)):t>p&&t<=Math.PI?(r=u.x+c-s.radius,a=r/e,o=a*i,l=-o+u.y,l<d-s.radius?(h.x=-c+s.radius,h.y=l):(o=d-s.radius-u.y,a=o/i,r=a*e,h.x=r+u.x,h.y=d-s.radius)):0>t&&t>=-p?(r=c-s.radius-u.x,a=r/e,o=a*i,l=o+u.y,l>-d+s.radius?(h.x=c-s.radius,h.y=l):(o=u.y+d-s.radius,a=o/i,r=a*e,h.x=-r+u.x,h.y=-d+s.radius)):(r=u.x+c-s.radius,a=r/e,o=a*i,l=-o+u.y,l>-d+s.radius?(h.x=-c+s.radius,h.y=l):(o=u.y+d-s.radius,a=o/i,r=a*e,h.x=-r+u.x,h.y=-d+s.radius)),h}})}(t("../basics/foundation"),t("../basics/log"),t("./helpers/collision_helper"))},{"../basics/foundation":1,"../basics/log":3,"./helpers/collision_helper":15}],12:[function(t,i){i.exports=function(t,i){"use strict";return t.Class({init:function(t,e){i.log("A new Billiard.Pocket.DropState.Phase1 instance has been created!"),this.ball=t,this.pocket=e,this.aX=0,this.aY=0,this.spring=.05,this.dropFriction=.9,this.scale=.03,this.minScale=.7},proceed:function(){var t=this.ball.mesh.position,i=this.pocket.mesh.position.x-t.x,e=this.pocket.mesh.position.y-t.y,s=Math.sqrt(i*i+e*e);s+this.ball.radius<this.pocket.radius&&this.ball.mesh.scale.x<=this.minScale,this.aX=i*this.spring,this.aY=e*this.spring,this.ball.vX+=this.aX,this.ball.vY+=this.aY,this.ball.vX*=this.dropFriction,this.ball.vY*=this.dropFriction,t.x+=this.ball.vX,t.y+=this.ball.vY,this.ball.rotateByFraction(1),this.ball.rotateZ(),this.ball.mesh.scale.x>this.minScale&&(this.ball.mesh.scale.x-=this.scale,this.ball.mesh.scale.y-=this.scale,this.ball.mesh.scale.z-=this.scale)}})}(t("../../basics/foundation"),t("../../basics/log"))},{"../../basics/foundation":1,"../../basics/log":3}],13:[function(t,i){i.exports=function(t,i,e){"use strict";return t.Class({init:function(t){i.log("A new Billiard.Event.EventProcessor instance has been created!"),this.pubSub=t,this.registerHandlers(this.pubSub)},registerHandlers:function(t){t.subscribe(e.BALL_STOPPED_ROLLING,function(t){i.log("[EventProcessor]",e.BALL_STOPPED_ROLLING,t)})}})}(t("../../basics/foundation"),t("../../basics/log"),t("./events"))},{"../../basics/foundation":1,"../../basics/log":3,"./events":14}],14:[function(t,i){i.exports=function(){"use strict";return{BALL_STOPPED_ROLLING:"BALL_STOPPED_ROLLING",BALL_STARTED_ROLLING:"BALL_STARTED_ROLLING"}}()},{}],15:[function(t,i){i.exports=function(t,i){"use strict";function e(t,i,e,s,n,r,a,l,h,u){var c,d,p,f,g,m,b,y,v,x=o.tmp1,w=o.tmp2,A=o.p0;A.set(t,i);var _=o.pf;_.set(t+e,i+s);var C=_.sub(A),B=o.q0;B.set(r,a);var L=o.qf;L.set(r+l,a+h);var P=L.sub(B);x.subVectors(P,C),m=x.length(),c=m*m,w.subVectors(B,A),w.multiplyScalar(2),d=w.dot(x),w.subVectors(B,A),b=w.length(),y=n+u,p=b*b-y*y;var T=d*d,M=4*c*p,R=T-M;return R>=0?(v=Math.sqrt(R),f=(-d+v)/(2*c),g=(-d-v)/(2*c),Math.min(f,g)):null}function s(t,e,s,o,r,a,l,h,u,c,d,p,f){var g,m,b={},y=l-t,v=h-e,x=Math.atan2(v,y),w=Math.sin(x),A=Math.cos(x),_=f,C=i.rotateCoords(s,o,w,A,!0),B=i.rotateCoords(u,c,w,A,!0),L=1/(a+p),P=(a-_*p)*C.x*L+(1+_)*p*B.x*L,T=(1+_)*a*C.x*L+(p-_*a)*B.x*L;if(0===C.x&&0===C.y?(g=B.x,m=B.y):(g=C.x,m=C.y),n(g,m,y,v)){var M=5/7;b.vAngularZ1=-M*(C.y/r),b.vAngularZ2=M*(B.y/d),C.y=M*C.y,B.y=M*B.y}else b.vAngularZ1=0,b.vAngularZ2=0;var R=i.rotateCoords(P,C.y,w,A,!1),k=i.rotateCoords(T,B.y,w,A,!1);return b.vX1=R.x,b.vY1=R.y,b.vX2=k.x,b.vY2=k.y,b}function n(t,i,e,s){var n=t*e+i*s,o=Math.sqrt(t*t+i*i),r=Math.sqrt(e*e+s*s),a=n/(o*r),l=Math.acos(a);return l%(Math.PI/2)!==0}var o={p0:new t.Vector2(0,0),pf:new t.Vector2(0,0),q0:new t.Vector2(0,0),qf:new t.Vector2(0,0),tmp1:new t.Vector2(0,0),tmp2:new t.Vector2(0,0)};return{getCollisionTime:e,calculateBallCollisionReaction:s}}(window.THREE,t("./coords_rotation_helper"))},{"./coords_rotation_helper":16}],16:[function(t,i){i.exports=function(){"use strict";function t(t,i,e,s,n){return{x:n?t*s+i*e:t*s-i*e,y:n?i*s-t*e:i*s+t*e}}return{rotateCoords:t}}()},{}],17:[function(t,i){i.exports=function(t){"use strict";function i(t,i,e){o.setFromAxisAngle(i,e),t.quaternion.multiplyQuaternions(o,t.quaternion)}function e(t,e){i(t,r,e)}function s(t,e){i(t,a,e)}function n(t,e){i(t,l,e)}var o=new t.Quaternion,r=new t.Vector3(0,0,1).normalize(),a=new t.Vector3(0,1,0).normalize(),l=new t.Vector3(1,0,0).normalize();return{rotateAroundWorldAxisZ:e,rotateAroundWorldAxisY:s,rotateAroundWorldAxisX:n}}(window.THREE)},{}],18:[function(t,i){i.exports=function(t,i){"use strict";return t.Class({init:function(){i.log("A new Billiard.Rules.EightBall instance has been created!"),this.radius=20,this.ballIdTpl="images/ball#.jpg";var t=this._getRack();this.balls=this._getRackPositions(t),this.mass=1},_id:function(i){if(t.isUndefined(this.ballIdTpl))throw new Error("this.ballIdTpl is not defined!");return this.ballIdTpl.replace("#",i)},_getRack:function(){var t=this;return[[t._id(1),t._id(9),t._id(11),t._id(3),t._id(14)],[t._id(10),t._id(8),t._id(13),t._id(6)],[t._id(2),t._id(7),t._id(5)],[t._id(15),t._id(12)],[t._id(4)]]},_getRackPositions:function(t){for(var i,e,s,n={},o=-30*(Math.PI/180),r=150,a=0,l=0,h=0,u=0;u<t.length;u++){l=u*Math.cos(-1*o)*(this.radius+1)*2,h=u*Math.sin(-1*o)*(this.radius+1)*2;for(var c=0;c<t[u].length;c++)i=t[u][c],u||c||(n[this._id(0)]={x:-300,y:0}),e=r+l+Math.cos(o)*(this.radius+1)*2*c,s=a+h+Math.sin(o)*(this.radius+1)*2*c,n[i]={x:e,y:s}}return n},getBalls:function(){var t,i={};for(t in this.balls)this.balls.hasOwnProperty(t)&&(i[t]=this.balls[t]);return i},getBallRadius:function(){return this.radius},getBallMass:function(){return this.mass}})}(t("../../../basics/foundation"),t("../../../basics/log"))},{"../../../basics/foundation":1,"../../../basics/log":3}],19:[function(t,i){i.exports=function(t,i){"use strict";return t.Class({init:function(t,e){i.log("A new Billiard.Table.Default instance has been created!"),this.playingFieldWidth=t,this.playingFieldHeight=e,this.backgroundTexture="images/table_default.png";var s=24;this.pockets={top:{x:0,y:e/2-s,radius:s},topLeft:{x:-(t/2)+s,y:e/2-s,radius:s},topRight:{x:t/2-s,y:e/2-s,radius:s},bottom:{x:0,y:-(e/2)+s,radius:s},bottomLeft:{x:-(t/2)+s,y:-(e/2)+s,radius:s},bottomRight:{x:t/2-s,y:-(e/2)+s,radius:s}}},getPlayingFieldWidth:function(){return this.playingFieldWidth},getPlayingFieldHeight:function(){return this.playingFieldHeight},getBackgroundTexture:function(){return this.backgroundTexture},getPockets:function(){return this.pockets}})}(t("../../basics/foundation"),t("../../basics/log"))},{"../../basics/foundation":1,"../../basics/log":3}],20:[function(t,i){i.exports=function(t,i,e,s){"use strict";return t.Class({init:function(){i.log("A new Billiard.AssetLoader instance has been created!"),this.maps={},this.textureLoader=new e.TextureLoader},getMap:function(e){if(t.isUndefined(this.maps[e])){var n,o,r,a=s.defer(),l=this;return n=function(t){i.log('[Billiard.AssetLoader] Texture "'+e+'" loaded.'),l.maps[e]=t,a.resolve(t)},o=function(t){i.log('[Billiard.AssetLoader] Loading texture "'+e+'"...',t),a.notify(t)},r=function(t){i.log('[Billiard.AssetLoader] Error while loading texture "'+e+'".'),a.reject(t)},this.textureLoader.load(e,n,o,r),a.promise}return i.log('[Billiard.AssetLoader] Returning cached texture "'+e+'".'),s.when(this.maps[e])},getMaps:function(t){var i,e,n=[];for(i=0,e=t.length;e>i;i++)n.push(this.getMap(t[i]));return s.all(n).then(function(s){var n={};for(i=0,e=t.length;e>i;i++)n[t[i]]=s[i];return n})}})}(t("../basics/foundation"),t("../basics/log"),window.THREE,window.Q)},{"../basics/foundation":1,"../basics/log":3}],21:[function(t,i){i.exports=function(t,i,e){"use strict";return{Game:t,EightBallRules:i,DefaultTable:e}}(t("./game/billiard_game"),t("./game/rules/eight_ball/eight_ball"),t("./game/tables/default"))},{"./game/billiard_game":7,"./game/rules/eight_ball/eight_ball":18,"./game/tables/default":19}]},{},[21])(21)});